<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jxd.student_information.mapper.ITeacherMapper">
    <!--学生总数======教师查询（cbb）-->
    <select id="selectAllStuTotalsWithTeacher" resultType="java.util.HashMap">
       ${sql}
        <where>
            <if test="teacher_id != 0">
                f.teacher_id = #{teacher_id}
            </if>
            <if test="student_name != null and student_name != ''">
                and f.student_name like concat('%',#{student_name},'%')
            </if>
                and isdeleted = 1
        </where>
        GROUP BY
        student_id
        order by student_id
    </select>
    <!--分页数据======教师查询（cbb）-->
    <select id="selectAllStuBypageWithTeacher" resultType="java.util.HashMap">
        ${sql}
        <where>
            <if test="teacher_id != 0">
                f.teacher_id = #{teacher_id}
            </if>
            <if test="student_name != null and student_name != ''">
                and f.student_name like concat('%',#{student_name},'%')
            </if>
                and isdeleted = 1
        </where>
        GROUP BY
        student_id
        order by student_id
        limit #{pageIndex},#{pageSize}
    </select>
    <!--拼接的SQL语句======教师查询拼接的（cbb）-->
    <select id="getSequence" resultType="java.lang.String">
       SELECT
	    GROUP_CONCAT( DISTINCT CONCAT( 'MAX(IF(course_name = ''', course_name, ''', score, null)) AS ''', course_name, '''' ) )
        FROM
        course
    </select>


    <insert id="insertTeacher">
        insert into teacher (teacher_name) values (#{teacherName});
        insert into userlogin (user_id,password,user_name,role) values
        ((select last_insert_id()),#{password},#{teacherName},#{role})
    </insert>

    <select id="selectAllTeacher" resultType="Teacher">
    select teacher_id,teacher_name from teacher
    <if test="teacherName != null and teacherName != ''">
        where teacher_name like concat('%',#{teacherName},'%')
    </if>
    </select>

    <select id="selectAllTeacherByPage" resultType="Teacher">
        select teacher_id,teacher_name from teacher
        <if test="teacherName != null and teacherName != ''">
            where teacher_name like concat('%',#{teacherName},'%')
        </if>
        order by teacher_id
        limit #{pageStart},#{pageSize}
    </select>

    <update id="updateTeacherById">
        update teacher set teacher_name = #{teacherName} where teacher_id = #{teacherId};
        update userlogin set user_name = #{teacherName}
        where user_id = #{teacherId}
    </update>
</mapper>
