<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jxd.student_information.mapper.IStudentMapper">
    <select id="getAllStudent" resultType="map">
        select s.student_id,s.student_name,s.sex,s.folk,s.birthday,s.native_place,
        s.marital_status,s.id_number, s.graduate_school,s.major,s.img_path,
        s.remark,s.class_no,s.isdeleted,d.dept_name from student s
        left join dept d on s.dept_no = d.dept_no
        <where>
            s.isdeleted = 1
            <if test="student_name != null and student_name != '' ">
                and s.student_name like concat('%',#{student_name},'%')
            </if>
            <if test="class_no != 0">
                and s.class_no = #{class_no}
            </if>
        </where>
    </select>

    <select id="getAllStudentByPage" resultType="map">
        select s.student_id,s.student_name,s.sex,s.folk,s.birthday,s.native_place,
        s.marital_status,s.id_number, s.graduate_school,s.major,s.img_path,
        s.remark,s.class_no,s.isdeleted,d.dept_name from student s
        left join dept d on s.dept_no = d.dept_no
        <where>
            s.isdeleted = 1
            <if test="student_name != null and student_name != '' ">
                and s.student_name like concat('%',#{student_name},'%')
            </if>
            <if test="class_no != 0">
                and s.class_no = #{class_no}
            </if>
        </where>
        order by s.student_id limit #{pageIndex}, #{pageSize}
    </select>

    <!--新增学员-->
    <insert id="addStudents">
        insert into student(student_name, sex, class_no, folk, birthday, marital_status, native_place, id_number, graduate_school, major, remark, img_path, dept_no,isdeleted)
        values (#{studentName},#{sex},#{classNo},#{folk},#{birthday},#{maritalStatus},#{nativePlace},#{idNumber},#{graduateSchool},#{major},#{remark},#{imgPath},1,1);
--       新增到学校评价表
        insert into evaluation_of_school(student_id,class_no)
            values((select LAST_INSERT_ID()),#{classNo});
--       新增到部门评价表
        insert into evaluation_of_dept(student_id,dept_no,period_no)
            values((select student_id from student order by student_id DESC limit 1),1,1);
        insert into evaluation_of_dept(student_id,dept_no,period_no)
            values((select student_id from student order by student_id DESC limit 1),1,2);
        insert into evaluation_of_dept(student_id,dept_no,period_no)
            values((select student_id from student order by student_id DESC limit 1),1,3);
        insert into evaluation_of_dept(student_id,dept_no,period_no)
            values((select student_id from student order by student_id DESC limit 1),1,4);
--
    </insert>
    <update id="delStudent">
        update student set isdeleted = 0
        where student_id = #{studentId}
    </update>
</mapper>
